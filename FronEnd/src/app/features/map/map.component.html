<div class="main-content">
  <div class="container">
    <div class="row">
      <div class="col-md-8 position-relative">
        <div id="map">
          <google-map id="map" height="600px" width="100%" [center]="center" [zoom]="zoom" [options]="opcionesMapa">

            <!-- Marcador para la ubicación actual con icono personalizado -->
            <map-marker *ngIf="markerPosition" [position]="markerPosition" [icon]="iconoUbicacionUsuario">
            </map-marker>

          </google-map>
        </div>
        <!-- En tu plantilla HTML -->
        <button *ngIf="rutaActiva" class="floating-button-cancel" (click)="cancelarRuta()">
          <i class="fas fa-times text-white"></i>
        </button>
        <button class="floating-button-location" (click)="centerOnUserLocation()">
          <i class="fa fa-location-arrow" aria-hidden="true"></i>
        </button>

      </div>
      <div class="col-md-4 sidebar">
        <p>¡Encuentra los mejores lugares de café en tu área!</p>
        <div *ngIf="rutaActiva && instruccionesRuta.length > 0">
          <h3>Detalles de la Ruta</h3>
          <p>{{ routeDetails }}</p>
          <ul>
            <li *ngFor="let instruction of instruccionesRuta">{{ instruction }}</li>
          </ul>
        </div>
        <div class="alert alert-info" *ngIf="showAlert" role="alert">
        </div>

        <br>

        <!-- Información adicional -->
        <div style="margin-top: 20px; background-color: #f8f9fa; padding: 10px; border-radius: 5px;">
          <h3 style="margin-bottom: 10px;">Información adicional</h3>
          <ul style="list-style-type: none; padding-left: 0;">
            <li style="margin-bottom: 10px;">
              <img src="assets/IconsMarker/cosechaUser.png" alt="Icono de persona"
                style="width: 20px; height: 20px; margin-right: 10px;">
              <span style="font-size: 16px;">Eres tú</span>
            </li>
            <li style="margin-bottom: 10px;">
              <img src="assets/IconsMarker/cafeteriaAroma.png" alt="Icono de persona"
                style="width: 20px; height: 20px; margin-right: 10px;">
              <span style="font-size: 16px;">Tienda de café</span>
            </li>
            <li style="margin-bottom: 10px;">
              <span style="color: green; font-size: 18px;">&#8226;</span> Tienda abierta
            </li>
            <li style="margin-bottom: 10px;">
              <span style="color: red; font-size: 18px;">&#8226;</span> Tienda cerrada
            </li>
          </ul>
        </div>
        <br>
        <button class="btn btn-primary" (click)="openModalReviewShop()">Califica la aplicación</button>
      </div>
    </div>
  </div>

  <div *ngIf="rutaActiva && instruccionesRuta.length > 0">
    <h3>Detalles de la Ruta</h3>
    <p>{{ routeDetails }}</p>
    <ul>
      <li *ngFor="let instruction of instruccionesRuta">{{ instruction }}</li>
    </ul>
  </div>

  <!-- Botón del librito -->
  <div class="button-container-footer">
    <button class="floating-button button-book" (click)="openModalAlbum()">
      <i class="fas fa-book text-white"></i>
    </button>
    <button class="floating-button button-camera" (click)="openModalWithCodigo()">
      <i class="fas fa-coffee text-white"></i>
    </button>
  </div>




  <!-- Modal para confirmar la ruta -->
  <ng-template #createModal let-modal>
    <div class="modal-content-create">
      <div class="modal-header-create">
        <h4 class="modal-title-create">{{ destinationName }}</h4>
      </div>
      <div class="modal-body-create">
        <img src="https://via.placeholder.com/150" alt="Imagen de café" class="img-fluid" style="width: 100%;">
        <p style="padding-top: 3%;">Información sobre el café...</p>
        <p style="padding-top: 3%;">Nombre: {{ destinationName }}</p>
        <p style="padding-top: 3%;">Especialidad 1: {{ specialties1 }}</p>
        <p style="padding-top: 3%;">Especialidad 2: {{ specialties2 }}</p>
        <p style="padding-top: 3%;">Estado de la tienda: {{ shopStatus ? 'Abierto' : 'Cerrado' }}</p>
        <div class="transport-selection" style="margin-top: 15px;">
          <label class="transport-label">
            <input type="radio" name="transport" [class.active]="modoTransporte === google.maps.TravelMode.DRIVING"
              (click)="seleccionarModoTransporte(google.maps.TravelMode.DRIVING)">
            <i class="fa fa-car" aria-hidden="true"></i>
          </label>
          <label class="transport-label">
            <input type="radio" name="transport" [class.active]="modoTransporte === google.maps.TravelMode.BICYCLING"
              (click)="seleccionarModoTransporte(google.maps.TravelMode.BICYCLING)">
            <i class="fa fa-bicycle" aria-hidden="true"></i>
          </label>
          <label class="transport-label">
            <input type="radio" name="transport" [class.active]="modoTransporte === google.maps.TravelMode.WALKING"
              (click)="seleccionarModoTransporte(google.maps.TravelMode.WALKING)">
            <i class="fa fa-blind" aria-hidden="true"></i>
          </label>
        </div>
      </div>
      <div class="modal-footer-create">
        <button type="button" class="btn btn-primary" (click)="calcularRuta()">Guíame</button>
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss('cancel')">Cancelar</button>
      </div>
    </div>
  </ng-template>

  <!-- Modal para cancelar la ruta -->
  <ng-template #cancelModal let-modal>
    <div class="modal-content-cancelR">
      <div class="modal-header-cancelR">
        <h4 class="modal-title-cancelR">Cancelar Rutas</h4>
      </div>
      <div class="modal-body-cancelR">
        <p>¿Estás seguro de que quieres cancelar las rutas?</p>
      </div>
      <div class="modal-footer-cancelR">
        <!-- <button type="button" class="btn" (click)="confirmCancelRoute()">Confirmar</button> -->
        <button type="button" class="btn" (click)="modal.dismiss('cancel')">Cancelar</button>
      </div>
    </div>
  </ng-template>

  <ng-template #codeModal let-modal>
    <div class="modal-content-code">
      <div class="modal-header-code">
        <h5 class="modal-title-code">Ingresa tu código y calificación:</h5>
      </div>
      <div class="modal-body-code">
        <label for="code">Código:</label>
        <input #codeInput type="text" id="code" class="form-control" [(ngModel)]="enteredCode"
          placeholder="Ingresa tu código" (input)="updateButtonState()">
        <br>
        <label for="rating">Calificación:</label>
        <div class="star-rating">
          <span *ngFor="let i of [1, 2, 3, 4, 5]; let index = index" [ngClass]="{
                  'star-filled': enteredRating > index,
                  'star-empty': enteredRating <= index
                }" (click)="setRating(index + 1); updateButtonState()">
            &#9733;
          </span>
        </div>
        <br>
        <label for="review">Reseña:</label>
        <textarea id="review" class="form-control" [(ngModel)]="enteredReview" placeholder="Escribe tu reseña"
          (input)="updateButtonState()"></textarea>
      </div>
      <div class="modal-footer-code">
        <button type="button" class="btn" (click)="verifyCode()" [disabled]="isButtonDisabled">Verificar</button>
        <button type="button" class="btn" (click)="modal.dismiss('cancel')">Cancelar</button>
      </div>
    </div>
  </ng-template>
  
<!-- Modal calficar tienda -->
<ng-template #modalReviewShop let-modal>
  <div class="modal-content-review">
    <div class="modal-header-review">
      <h5 class="modal-title-review">Califica la aplicación</h5>
    </div>
    <div class="modal-body-review">
      <label for="reviewApp">Comentario o sugerencia:</label>
      <input 
        #codeInput 
        type="text" 
        id="reviewApp" 
        class="form-control" 
        [(ngModel)]="reviewApp"
        placeholder="Ingresa tu comentario o sugerencia" 
        (input)="updateButtonReviewState()">
    </div>
    <div class="modal-footer-review">
      <button 
        type="button" 
        class="btn" 
        (click)="addReviewToApp()" 
        [disabled]="isButtonDisabled">
        Enviar
      </button>
      <button 
        type="button" 
        class="btn" 
        (click)="modal.dismiss('cancel')">
        Cerrar
      </button>
    </div>
  </div>
</ng-template>

  <!-- Modal álbum -->
  <ng-template #modalBook let-modal>
    <div class="modal-content modal-book">
      <div class="modal-header">
        <h5 class="modal-title">Álbum</h5>
      </div>
      <div class="modal-body">
        <div class="album-info">
          <div class="missing-stamps">
            Estampitas obtenidas: {{ obtainedStamps }}/{{ totalStamps }}
          </div>
        </div>
        <div class="album">
          <div class="album-page" *ngFor="let shop of shopLogos">
            <img *ngIf="shop.logoUrl" [src]="shop.logoUrl" [class.colored]="isLogoColored(shop.logoUrl)"
              alt="{{ shop.name }}">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss('cancel')">Cerrar</button>
      </div>
    </div>
  </ng-template>

  <!-- Modal de llegada al café -->
  <ng-template #arriveModal let-modal>
    <div class="modal-content-coffee modal-coffee">
      <div class="modal-header-coffee">
        <h4 class="modal-title-coffee" id="modal-title-coffee">¡¡Llegaste a {{ destinationName }}!!</h4>
      </div>
      <div class="modal-body-coffee">
        <div class="image-gallery-coffee">
          <img src="https://via.placeholder.com/150" alt="Imagen de café" class="img-fluid gallery-image">
          <img src="https://via.placeholder.com/150" alt="Imagen de café" class="img-fluid gallery-image">
          <img src="https://via.placeholder.com/150" alt="Imagen de café" class="img-fluid gallery-image">
        </div>
        <p class="description-coffee">
          Información sobre el café...
        </p>
      </div>
      <div class="modal-footer-coffee">
        <button type="button" class="btn" (click)="confirmarLlegada()">Si, he llegado</button>
        <button type="button" class="btn" (click)="cancelArrive(modal)">Cancelar</button>
      </div>
    </div>
  </ng-template>
</div>